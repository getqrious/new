(m => {
    var e = !!(e = m.EcHeap) && e.constructor + "" == "String" && ((e = m.EcHeap) ? e.replace(/^[\s\xa0]+|[\s\xa0]+$/g, "") : "") || "eca",
        o = m[e].q || [];
    let g = document.currentScript.getAttribute("eca-domain");
    if (g) {
        let p = {
                visitorId: "__eca_v_id_",
                sessionId: "__eca_s_id_",
                platformId: "__eca_p_id_"
            },
            t = new function() {
                let n = {},
                    o = {
                        visitorId: {
                            name: "visitorId",
                            type: "number"
                        },
                        sessionId: {
                            name: "sessionId",
                            type: "number"
                        },
                        platformId: {
                            name: "platformId",
                            type: "string"
                        },
                        allowCookies: {
                            name: "allowCookies",
                            type: "boolean"
                        },
                        verbose: {
                            name: "verbose",
                            type: "boolean"
                        }
                    };
                return a(!1), r(!1), s((() => {
                    try {
                        return localStorage.getItem(p.visitorId)
                    } catch (e) {
                        return null
                    }
                })()), l((() => {
                    try {
                        return localStorage.getItem(p.sessionId)
                    } catch (e) {
                        return null
                    }
                })()), i(v()), n.send = function() {
                    ! function() {
                        var e = arguments[1];
                        if (m.navigator.sendBeacon) {
                            c(n.sessionId) && u(), e.sessionId = n.sessionId;
                            let t = (e => {
                                try {
                                    var t = `PSec__storefront__ab__test__${e}PSec__storefront__ab__test`;
                                    return localStorage.getItem(t)
                                } catch (e) {
                                    return null
                                }
                            })(e.storeId);
                            try {
                                t = JSON.parse(t)
                            } catch (e) {
                                t = null
                            }
                            null != (t = null == t || null != t.group && null != t.name ? t : null) && (20 < t.group.length || 50 < t.name.length) && (t = null), e.storefrontAbTest = t, (e => (e = e.substring(0, e.length - 6), 31536e6 < Date.now() - e))(n.visitorId) && d(), e.visitorId = n.visitorId, m.navigator.sendBeacon(g + "/register", JSON.stringify(e)), f("send", e)
                        }
                    }.apply(null, arguments)
                }, n.config = function() {
                    ! function(e, t) {
                        switch (f("config", e + "=" + t), e) {
                            case o.visitorId.name:
                                null != t && typeof t !== o.visitorId.type || s(t);
                                break;
                            case o.platformId.name:
                                null != t && typeof t !== o.platformId.type || i(t);
                                break;
                            case o.sessionId.name:
                                null != t && typeof t !== o.sessionId.type || l(t);
                                break;
                            case o.allowCookies.name:
                                typeof t === o.allowCookies.type && r(t);
                                break;
                            case o.verbose.name:
                                typeof t === o.verbose.type && a(t);
                                break;
                            case "revokeCookies":
                                f("revokeCookies"), r(!1), Object.values(p).forEach(I), s(null), l(null)
                        }
                    }.apply(null, [].slice.call(arguments, 1))
                }, n.get = function() {
                    return function(e) {
                        if (e in o) return n[o[e].name]
                    }.apply(null, [].slice.call(arguments, 1))
                }, n;

                function r(e) {
                    (n.allowCookies = e) && (s(n.visitorId), l(n.sessionId), i(n.platformId))
                }

                function s(e) {
                    f("updateVisitorId", e), null == e ? d() : n.visitorId = t(p.visitorId, e), m.analytics_visitorId = n.visitorId
                }

                function i(e) {
                    f("updatePlatformId", e), null == e ? (f("resetPlatformId"), n.platformId = v()) : n.platformId = t(p.platformId, e)
                }

                function l(e) {
                    f("updateSessionId", e), null == e ? u() : n.sessionId = t(p.sessionId, e), n.sessionId && !c(n.sessionId) || u()
                }

                function a(e) {
                    n.verbose = e
                }

                function c(e) {
                    e = e.substring(0, e.length - 6);
                    return 18e5 < Date.now() - e
                }

                function u() {
                    f("resetSession"), n.sessionId = t(p.sessionId, y())
                }

                function d() {
                    f("resetVisitorId"), n.visitorId = t(p.visitorId, y())
                }

                function t(e, t) {
                    if (t = t || y(), n.allowCookies) try {
                        f("localStorage.setItem", e + "=" + t), localStorage.setItem(e, t)
                    } catch (e) {
                        f("initStorage error", e)
                    }
                    return t
                }

                function I(e) {
                    f("removeStorage", e);
                    try {
                        localStorage.removeItem(e)
                    } catch (e) {
                        f("removeStorage error", e)
                    }
                }

                function f(e, t) {
                    var o;
                    n && n.verbose && (o = {
                        visitorId: n.visitorId,
                        sessionId: n.sessionId,
                        allowCookies: n.allowCookies,
                        platformId: n.platformId
                    }, console.log(e, o, t))
                }
            };
        m[e] = n;
        for (let e = 0; e < o.length; e++) n.apply(null, [].slice.call(o[e]));

        function n(e) {
            if (t.hasOwnProperty(e)) return t[e].apply(t, arguments);
            try {
                console.warn("Can't send action", e)
            } catch (e) {}
        }

        function v() {
            try {
                return localStorage.getItem(p.platformId)
            } catch (e) {
                return null
            }
        }

        function y() {
            let e = Math.floor(Math.pow(10, 6) * Math.random()) + "";
            for (e = e.substring(0, 6); e.length < 6;) e = "0" + e;
            return +new Date + "" + e
        }
    } else console.warn("eca-domain is not defined")
})(window);